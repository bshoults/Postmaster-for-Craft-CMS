{% import "_includes/forms" as forms %}
{% import "postmaster/_includes/forms" as postmaster %}

<div id="recipient">

	{{ forms.textField({
		label: "Title"|t,
	    instructions: "A unique word or phrase that describes this parce."|t,
		id: 'title',
		name: 'title',
		value: title,
		translatable: true,
		autocomplete: true
	}) }}

	{% set parcelTypeOptions = [] %}

	{% for parcelType in craft.postmaster.parcelTypes() %}
		{% set parcelTypeOptions = parcelTypeOptions|merge([{
			value: parcelType.getClass(),
			label: parcelType.name,
			target: '#' ~ parcelType.id ~ '-parcel-settings, #' ~ parcelType.id ~ '-parcel-fields'
		}]) %}
	{% endfor %}

	{{ postmaster.selectField({
		label: "Parcel Type"|t,
		instructions: "Select the type of parcel you want to use."|t,
		id: 'triggers',
		name: 'settings[parcelType]',
		options: parcelTypeOptions,
		value: settings.parcelType,
		class: 'show-onchange'
	}) }}

	{% for parcelType in craft.postmaster.parcelTypes() %}
	<div id="{{ parcelType.id }}-parcel-fields">
		
		{% set html = parcelType.getInputHtml({settings: settings.parcelTypeSettings[parcelType.id]}) %}

		{% if html %}		
			<hr>

			{{ html|raw }}

		{% endif %}

	</div>
	{% endfor %}

</div>

<div id="settings" class="hidden">

	{{ forms.lightswitchField({
		first: true,
		label: "Enabled"|t,
		id: 'enabled',
		name: 'enabled',
		on: enabled,
		onLabel: "On"|t,
		offLabel: "Off"|t
	}) }}

	{% for parcelType in craft.postmaster.parcelTypes() %}

		{% set html = parcelType.getSettingsInputHtml({settings: settings.parcelTypeSettings[parcelType.id]}) %}

		{% if html %}
		<div id="{{ parcelType.id }}-parcel-settings">
			
			<hr>

			{{ html|raw }}

		</div>
		{% endif %}

	{% endfor %}

</div>

<div id="service" class="hidden">

	{% set services = craft.postmaster.services() %}
	{% set serviceTypeOptions = [] %}

	{% for service in services %}
		{% set serviceTypeOptions = serviceTypeOptions|merge([{
			value: service.getClass(),
			label: service.name,
			target: '#'~service.id
		}]) %}
	{% endfor %}

	{{ postmaster.selectField({
		label: "Service"|t,
		instructions: "Select the type of service that will be used to send the parcel."|t,
		id: 'service',
		name: 'settings[service]',
		options: serviceTypeOptions,
		value: settings.service,
		targetSuffix: '-service-settings',
		class: 'show-onchange'
	}) }}

	{% for service in services %}
	<div id="{{ service.id }}-service-settings">

		{% set html = service.getInputHtml({settings: settings.serviceSettings[service.id]}) %}

		{% if html %}
		<div id="{{ service.id }}-parcel-settings">
			
			<hr>

			<h3>{{ service.name ~ ' Settings'|t }}</h3>

			{{ html|raw }}

		</div>
		{% endif %}

	</div>
	{% endfor %}

</div>